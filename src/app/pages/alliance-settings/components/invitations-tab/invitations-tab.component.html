<mat-card class="tab-content">
  <mat-card-header>
    <mat-card-title>{{ 'alliance.settings.invitationManagement' | translate }}</mat-card-title>
  </mat-card-header>
  
  <mat-card-content>
    <!-- Create Invitation Form -->
    <form [formGroup]="invitationForm" (ngSubmit)="createInvitation()" class="invitation-form">
      <mat-form-field appearance="outline">
        <mat-label>{{ 'alliance.settings.invitationDuration' | translate }}</mat-label>
        <input
          matInput
          formControlName="durationDays"
          type="number"
          min="1"
          max="365"
        />
        <mat-icon matPrefix>schedule</mat-icon>
        <mat-hint>{{ 'alliance.settings.durationHint' | translate }}</mat-hint>
      </mat-form-field>

      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="invitationForm.invalid || isLoading() || isSubmitting()"
        class="create-invitation-btn"
      >
        <mat-icon>add</mat-icon>
        {{ 'alliance.settings.createInvitation' | translate }}
      </button>
    </form>

    <!-- Invitations List -->
    @if (invitations().length === 0) {
      <div class="empty-state">
        <mat-icon>mail_outline</mat-icon>
        <p>{{ 'alliance.settings.noInvitations' | translate }}</p>
      </div>
    } @else {
      <mat-accordion class="invitations-accordion">
        @for (invitation of invitations(); track invitation.id) {
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <div class="invitation-header">
                  <div class="invitation-info">
                    <mat-icon>link</mat-icon>
                    <code class="token-code">{{ invitation.token.substring(0, 12) }}...</code>
                    <button
                      mat-icon-button
                      (click)="copyInvitationLink(invitation.token); $event.stopPropagation()"
                      [matTooltip]="'alliance.settings.copyLink' | translate"
                    >
                      <mat-icon>content_copy</mat-icon>
                    </button>
                  </div>
                  <div class="invitation-badges">
                    @if (invitation.usage_count > 0) {
                      <mat-chip [matBadge]="invitation.usage_count" matBadgeColor="primary">
                        {{ invitation.usage_count }} {{ 'alliance.settings.members' | translate }}
                      </mat-chip>
                    }
                    <mat-chip [class]="getInvitationStatusClass(invitation)">
                      {{ getInvitationStatus(invitation) }}
                    </mat-chip>
                  </div>
                </div>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <!-- Invitation Details -->
            <div class="invitation-details">
              <div class="detail-row">
                <span class="detail-label">{{ 'alliance.settings.expiresAt' | translate }}:</span>
                <span class="detail-value">{{ formatDate(invitation.expires_at) }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">{{ 'alliance.settings.createdAt' | translate }}:</span>
                <span class="detail-value">{{ formatDate(invitation.created_at) }}</span>
              </div>

              <!-- Members who joined via this invitation -->
              @if (invitation.members && invitation.members.length > 0) {
                <div class="members-section">
                  <h4>{{ 'alliance.settings.membersJoined' | translate }}</h4>
                  <mat-list>
                    @for (member of invitation.members; track member.id) {
                      <mat-list-item>
                        <mat-icon matListItemIcon>person</mat-icon>
                        <div matListItemTitle>{{ member.display_name }}</div>
                        <div matListItemLine>{{ '@' + member.username }} â€¢ {{ formatDate(member.created_at) }}</div>
                      </mat-list-item>
                    }
                  </mat-list>
                </div>
              }

              <!-- Actions -->
              <div class="invitation-actions">
                @if (!isInvitationExpired(invitation.expires_at)) {
                  <button
                    mat-raised-button
                    color="warn"
                    (click)="revokeInvitation(invitation.id)"
                    [disabled]="isSubmitting()"
                  >
                    <mat-icon>delete</mat-icon>
                    {{ 'alliance.settings.revokeInvitation' | translate }}
                  </button>
                }
              </div>
            </div>
          </mat-expansion-panel>
        }
      </mat-accordion>
    }
  </mat-card-content>
</mat-card>
